{% extends 'dashboard/base.html' %}

{% block content %}
<br>
<br>
<div class="container mt-5">
  <div class="row" id="habitaciones-admin">

    <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap">
      <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#modalNuevaHabitacion">
        + Agregar Habitación
      </button>

      <div class="d-flex gap-2 mt-2 mt-md-0">
        <a href="{{ url_for('main.hospedaje_admin') }}" class="btn btn-primary">👥 Huéspedes</a>
        <a href="{{ url_for('main.habitaciones_admin') }}" class="btn btn-secondary">🏠 Habitaciones</a>
        <a href="{{ url_for('main.estadisticas_admin') }}" class="btn btn-success">📊 Estadísticas</a>
      </div>
    </div>

    {% for h in habitaciones %}
    <div class="col-md-4 mb-4">
      <div class="card shadow-sm position-relative" style="min-height:380px;">
        <!-- Imagen -->
        <img src="{{ url_for('static', filename=h.imagen if h.imagen else 'img/default.jpg') }}"
             class="card-img-top"
             style="height:200px; object-fit:cover;">

        <!-- Estado -->
        <span class="badge {{ 'bg-success' if h.estado == 'Disponible' else 'bg-danger' }}"
              style="position:absolute; top:15px; right:15px;">
          {{ h.estado }}
        </span>

        <div class="card-body">
          <h5 class="card-title">{{ h.nombre }}</h5>
          <p class="card-text mb-1"><strong>Cupo:</strong> {{ h.cupo_personas }}</p>
          <p class="card-text mb-2"><strong>Precio:</strong> ${{ '{:,.0f}'.format(h.precio) }} COP</p>

          <!-- Botones de acción -->
          <div class="text-center mt-2">
            <!-- Especificaciones -->
            <button class="btn btn-outline-primary btn-sm mb-1"
                    data-bs-toggle="modal"
                    data-bs-target="#detalleHabitacion{{ h.id }}">
              <i class="bi bi-info-circle me-1"></i> Especificaciones
            </button>

            <!-- Editar -->
            <button class="btn btn-outline-warning btn-sm mb-1"
                    data-bs-toggle="modal"
                    data-bs-target="#modalEditar{{ h.id }}"
                    title="Editar habitación">
              <i class="bi bi-pencil-square"></i>
            </button>

            <!-- Eliminar -->
            <form action="{{ url_for('admin.hospedaje_eliminar', habitacion_id=h.id) }}"
                  method="POST"
                  style="display:inline;">
              <button type="submit"
                      class="btn btn-outline-danger btn-sm mb-1"
                      title="Eliminar habitación"
                      onclick="return confirm('¿Seguro que deseas eliminar esta habitación?')">
                <i class="bi bi-trash"></i>
              </button>
            </form>
          </div>
        </div>

        <!-- Modal Especificaciones -->
        <div class="modal fade" id="detalleHabitacion{{ h.id }}" tabindex="-1">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">{{ h.nombre }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <p><strong>Cupo:</strong> {{ h.cupo_personas }}</p>
                <p><strong>Precio:</strong> ${{ '{:,.0f}'.format(h.precio) }} COP</p>
                <p><strong>Estado:</strong> {{ h.estado }}</p>
                <p><strong>Descripción:</strong> {{ h.descripcion or 'Sin descripción' }}</p>

                <div class="d-flex justify-content-end mt-3">
                  <!-- Editar -->
                  <button type="button" class="btn btn-primary btn-sm me-2"
                          data-bs-toggle="modal"
                          data-bs-target="#modalEditar{{ h.id }}">
                    Editar
                  </button>

                  <!-- Eliminar -->
                  <form action="{{ url_for('admin.hospedaje_eliminar', habitacion_id=h.id) }}"
                        method="POST" style="display:inline;">
                    <button type="submit" class="btn btn-danger btn-sm"
                            onclick="return confirm('¿Seguro que deseas eliminar esta habitación?')">
                      Eliminar
                    </button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Modal Leer más -->
        <div class="modal fade" id="modalHabitacion{{ h.id }}" tabindex="-1"
             aria-labelledby="modalHabitacionLabel{{ h.id }}" aria-hidden="true">
          <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="modalHabitacionLabel{{ h.id }}">{{ h.nombre }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
              </div>
              <div class="modal-body">
                <div class="row">
                  <!-- Imagen izquierda -->
                  <div class="col-md-5">
                    <img src="{{ url_for('static', filename=h.imagen if h.imagen else 'img/default.jpg') }}"
                         class="img-fluid rounded shadow-sm" alt="{{ h.nombre }}">
                  </div>
                  <!-- Datos derecha -->
                  <div class="col-md-7">
                    <p><strong>Cupo:</strong> {{ h.cupo_personas }}</p>
                    <p><strong>Precio:</strong> ${{ '{:,.0f}'.format(h.precio) }} COP</p>
                    <p><strong>Estado:</strong> {{ h.estado }}</p>
                    {% if h.descripcion %}
                      <p><strong>Descripción:</strong> {{ h.descripcion }}</p>
                    {% else %}
                      <p><strong>Descripción:</strong> <span class="text-muted">Sin descripción</span></p>
                    {% endif %}
                  </div>
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Modal Editar -->
        <div class="modal fade" id="modalEditar{{ h.id }}" tabindex="-1"
             aria-labelledby="modalEditarLabel{{ h.id }}" aria-hidden="true">
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <form action="{{ url_for('admin.hospedaje_editar', habitacion_id=h.id) }}"
                    method="POST" enctype="multipart/form-data">
                <div class="modal-header">
                  <h5 class="modal-title" id="modalEditarLabel{{ h.id }}">Editar {{ h.nombre }}</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                  <div class="row">
                    <div class="col-md-6">
                      <label class="form-label">Nombre</label>
                      <input type="text" class="form-control" name="nombre" value="{{ h.nombre }}" required>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Precio</label>
                      <input type="number" class="form-control" name="precio" value="{{ h.precio }}" required>
                    </div>
                    <div class="col-md-6 mt-3">
                      <label class="form-label">Cupo Personas</label>
                      <input type="number" class="form-control" name="cupo_personas" value="{{ h.cupo_personas }}" required>
                    </div>
                    <div class="col-md-6 mt-3">
                      <label class="form-label">Estado</label>
                      <select class="form-select" name="estado">
                        <option value="Disponible" {% if h.estado == "Disponible" %}selected{% endif %}>Disponible</option>
                        <option value="Mantenimiento" {% if h.estado == "Mantenimiento" %}selected{% endif %}>Mantenimiento</option>
                        <option value="Ocupada" {% if h.estado == "Ocupada" %}selected{% endif %}>Ocupada</option>
                      </select>
                    </div>
                    <div class="col-md-12 mt-3">
                      <label class="form-label">Descripción</label>
                      <textarea class="form-control" name="descripcion" rows="3" required>{{ h.descripcion }}</textarea>
                    </div>
                    <div class="col-md-12 mt-3">
                      <label class="form-label">Imagen</label>
                      <input type="file" class="form-control" name="imagen" accept="image/*">
                      {% if h.imagen %}
                        <small class="text-muted">Actual: {{ h.imagen }}</small>
                      {% endif %}
                    </div>
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="submit" class="btn btn-primary">Guardar cambios</button>
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}

    <!-- Modal Agregar Nueva Habitación -->
    <div class="modal fade" id="modalNuevaHabitacion" tabindex="-1"
         aria-labelledby="modalNuevaHabitacionLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalNuevaHabitacionLabel">Agregar Nueva Habitación</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body">
            <form action="{{ url_for('admin.hospedaje_nueva') }}" method="POST"
                  enctype="multipart/form-data" class="p-4 rounded shadow" style="background: #fff;">
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="nombre" class="form-label">Nombre</label>
                  <input type="text" class="form-control" id="nombre" name="nombre" required>
                </div>
                <div class="col-md-3">
                  <label for="precio" class="form-label">Precio</label>
                  <input type="number" class="form-control" id="precio" name="precio" min="0" step="0.01" required>
                </div>
                <div class="col-md-3">
                  <label for="cupo_personas" class="form-label">Cupo Personas</label>
                  <input type="number" class="form-control" id="cupo_personas" name="cupo_personas" min="1" required>
                </div>
                <div class="col-md-6">
                  <label for="estado" class="form-label">Estado</label>
                  <select class="form-select" id="estado" name="estado">
                    <option value="Disponible">Disponible</option>
                    <option value="Mantenimiento">Mantenimiento</option>
                    <option value="Ocupada">Ocupada</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label for="imagen" class="form-label">Imagen</label>
                  <input type="file" class="form-control" id="imagen" name="imagen" accept="image/*" required>
                </div>
                <div class="col-md-12">
                  <label for="descripcion" class="form-label">Descripción</label>
                  <textarea class="form-control" id="descripcion" name="descripcion" rows="3" required></textarea>
                </div>
              </div>
              <div class="d-flex justify-content-center mt-4">
                <button type="submit" class="btn btn-main px-5">Agregar Habitación</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    
  </div>
</div>
{% endblock %}
