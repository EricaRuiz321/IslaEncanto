{% extends 'usuario/base.html' %}  

{% block content %}
<br>
<div class="container mt-5">
  <div class="row" id="habitaciones-user">
    {% if habitaciones|length == 0 %}
      <div class="col-12">
        <div class="alert alert-info">Por el momento no hay habitaciones disponibles. Vuelve pronto.</div>
      </div>
    {% endif %}

    {% for h in habitaciones %}
      <div class="col-md-4 mb-4">
        <div class="card habitacion-card estado-{{ h.estado|lower }}" 
             style="min-height:420px; max-height:420px; display:flex; flex-direction:column; justify-content:space-between; position:relative;">
          
          <!-- Imagen -->
          <img src="{{ url_for('static', filename=h.imagen if h.imagen else 'img/default.jpg') }}" 
               class="card-img-top" alt="{{ h.nombre }}" style="height:200px; object-fit:cover;">

          <!-- Estado / Badge ARRIBA -->
          <span class="badge estado-label {{ h.estado|lower }}" 
                style="position:absolute; top:16px; right:16px; font-size:0.9rem; padding:0.5em 1em; border-radius:1rem;">
            {{ h.estado }}
          </span>

          <!-- Cuerpo -->
          <div class="card-body d-flex flex-column" style="flex:1 1 auto;">
            <h5 class="card-title">{{ h.nombre }}</h5>
            <p class="card-text mb-2">
              <strong>Cupo:</strong> {{ h.cupo_personas }} <br>
              <strong>Precio:</strong> ${{ '{:,.0f}'.format(h.precio) }} COP
            </p>

            <!-- breve descripción (recortada si es larga) -->
            <p class="card-text text-muted" style="max-height:64px; overflow:hidden;">
              {{ h.descripcion or "Sin descripción." }}
            </p>

            <!-- Botón Leer más (abajo alineado a la derecha) -->
            <div class="mt-auto d-flex justify-content-end">
              <button type="button" class="btn btn-link p-0" 
                      data-bs-toggle="modal" data-bs-target="#modalHabitacion{{ h.id }}">
                Leer más
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal para mostrar toda la info de la habitación -->
      <div class="modal fade" id="modalHabitacion{{ h.id }}" tabindex="-1" aria-labelledby="modalHabitacionLabel{{ h.id }}" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="modalHabitacionLabel{{ h.id }}">{{ h.nombre }}</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
              <img src="{{ url_for('static', filename=h.imagen if h.imagen else 'img/default.jpg') }}" class="img-fluid mb-3" alt="{{ h.nombre }}">
              <p><strong>Cupo:</strong> {{ h.cupo_personas }}</p>
              <p><strong>Precio:</strong> ${{ '{:,.0f}'.format(h.precio) }} COP</p>
              <p><strong>Estado:</strong> {{ h.estado }}</p>
              {% if h.descripcion %}
                <p><strong>Descripción:</strong> {{ h.descripcion }}</p>
              {% else %}
                <p><strong>Descripción:</strong> <span class="text-muted">Sin descripción</span></p>
              {% endif %}
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
              {# Opcional: añadir botón reservar dentro del modal #}
              {# <a href="{{ url_for('reservas.reservar', habitacion_id=h.id) }}" class="btn btn-primary">Reservar ahora</a> #}
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
</div>
{% endblock %}
